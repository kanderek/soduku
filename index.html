<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Uber - Soduku</title>
    <link rel="stylesheet" href="css/sudoku.css">
  </head>

  <body>

    <header>
      <div class="headline">
        <h1>Sudoku Times</h1>
        <div class="select-new-puzzle">
          <span>New puzzle</span><div class="caret"></div>
          <div class="select-puzzle-options">
          </div>
        </div>
      </div>
    </header>

    <main class="group">

      <section id="game-details" class="group">
        <div class="difficulty-display">
          <p>Difficulty:</p>
          <p><span>Easy</span></p>
        </div>

        <div id="timer-1" class="timer">
          <div class="timer-display">
            <p>Timer:</p>
            <p><span class="time-passed">0:00</span></p>
          </div>
          <input type="checkbox" class="toggle" id="timer-start" value="start">
          <label for="timer-start">Start</label>
        </div>
      </section>

      <section id="puzzle" class="group">
    <table id="soduku-board">
      <tbody>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,0"><div class="hint-overlay">123</div></div></td>
        <td><input type="number" min="1" max="9" data-cell="0,1"></td>
        <td><input type="number" min="1" max="9" data-cell="0,2"></td>
        <td><input type="number" min="1" max="9" data-cell="0,3"></td>
        <td><input type="number" min="1" max="9" data-cell="0,4"></td>
        <td><input type="number" min="1" max="9" data-cell="0,5"></td>
        <td><input type="number" min="1" max="9" data-cell="0,6"></td>
        <td><input type="number" min="1" max="9" data-cell="0,7"></td>
        <td><input type="number" min="1" max="9" data-cell="0,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="1,0"></td>
        <td><input type="number" min="1" max="9" data-cell="1,1"></td>
        <td><input type="number" min="1" max="9" data-cell="1,2"></td>
        <td><input type="number" min="1" max="9" data-cell="1,3"></td>
        <td><input type="number" min="1" max="9" data-cell="1,4"></td>
        <td><input type="number" min="1" max="9" data-cell="1,5"></td>
        <td><input type="number" min="1" max="9" data-cell="1,6"></td>
        <td><input type="number" min="1" max="9" data-cell="1,7"></td>
        <td><input type="number" min="1" max="9" data-cell="1,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="2,0"></td>
        <td><input type="number" min="1" max="9" data-cell="2,1"></td>
        <td><input type="number" min="1" max="9" data-cell="2,2"></td>
        <td><input type="number" min="1" max="9" data-cell="2,3"></td>
        <td><input type="number" min="1" max="9" data-cell="2,4"></td>
        <td><input type="number" min="1" max="9" data-cell="2,5"></td>
        <td><input type="number" min="1" max="9" data-cell="2,6"></td>
        <td><input type="number" min="1" max="9" data-cell="2,7"></td>
        <td><input type="number" min="1" max="9" data-cell="2,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="3,0"></td>
        <td><input type="number" min="1" max="9" data-cell="3,1"></td>
        <td><input type="number" min="1" max="9" data-cell="3,2"></td>
        <td><input type="number" min="1" max="9" data-cell="3,3"></td>
        <td><input type="number" min="1" max="9" data-cell="3,4"></td>
        <td><input type="number" min="1" max="9" data-cell="3,5"></td>
        <td><input type="number" min="1" max="9" data-cell="3,6"></td>
        <td><input type="number" min="1" max="9" data-cell="3,7"></td>
        <td><input type="number" min="1" max="9" data-cell="3,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="4,0"></td>
        <td><input type="number" min="1" max="9" data-cell="4,1"></td>
        <td><input type="number" min="1" max="9" data-cell="4,2"></td>
        <td><input type="number" min="1" max="9" data-cell="4,3"></td>
        <td><input type="number" min="1" max="9" data-cell="4,4"></td>
        <td><input type="number" min="1" max="9" data-cell="4,5"></td>
        <td><input type="number" min="1" max="9" data-cell="4,6"></td>
        <td><input type="number" min="1" max="9" data-cell="4,7"></td>
        <td><input type="number" min="1" max="9" data-cell="4,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="5,0"></td>
        <td><input type="number" min="1" max="9" data-cell="5,1"></td>
        <td><input type="number" min="1" max="9" data-cell="5,2"></td>
        <td><input type="number" min="1" max="9" data-cell="5,3"></td>
        <td><input type="number" min="1" max="9" data-cell="5,4"></td>
        <td><input type="number" min="1" max="9" data-cell="5,5"></td>
        <td><input type="number" min="1" max="9" data-cell="5,6"></td>
        <td><input type="number" min="1" max="9" data-cell="5,7"></td>
        <td><input type="number" min="1" max="9" data-cell="5,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="6,0"></td>
        <td><input type="number" min="1" max="9" data-cell="6,1"></td>
        <td><input type="number" min="1" max="9" data-cell="6,2"></td>
        <td><input type="number" min="1" max="9" data-cell="6,3"></td>
        <td><input type="number" min="1" max="9" data-cell="6,4"></td>
        <td><input type="number" min="1" max="9" data-cell="6,5"></td>
        <td><input type="number" min="1" max="9" data-cell="6,6"></td>
        <td><input type="number" min="1" max="9" data-cell="6,7"></td>
        <td><input type="number" min="1" max="9" data-cell="6,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="7,0"></td>
        <td><input type="number" min="1" max="9" data-cell="7,1"></td>
        <td><input type="number" min="1" max="9" data-cell="7,2"></td>
        <td><input type="number" min="1" max="9" data-cell="7,3"></td>
        <td><input type="number" min="1" max="9" data-cell="7,4"></td>
        <td><input type="number" min="1" max="9" data-cell="7,5"></td>
        <td><input type="number" min="1" max="9" data-cell="7,6"></td>
        <td><input type="number" min="1" max="9" data-cell="7,7"></td>
        <td><input type="number" min="1" max="9" data-cell="7,8"></td>
      </tr>
      <tr>
        <td><input type="number" min="1" max="9" data-cell="8,0"></td>
        <td><input type="number" min="1" max="9" data-cell="8,1"></td>
        <td><input type="number" min="1" max="9" data-cell="8,2"></td>
        <td><input type="number" min="1" max="9" data-cell="8,3"></td>
        <td><input type="number" min="1" max="9" data-cell="8,4"></td>
        <td><input type="number" min="1" max="9" data-cell="8,5"></td>
        <td><input type="number" min="1" max="9" data-cell="8,6"></td>
        <td><input type="number" min="1" max="9" data-cell="8,7"></td>
        <td><input type="number" min="1" max="9" data-cell="8,8"></td>
      </tr>
    </tbody>
    </table>
  </section>

      <section id="game-controls" class="group">
        <div id="pallete" class="medium-toggle group">
          <input type="radio" id="medium-option1" class="toggle-select toggle-select-left" name="medium" value="pen" checked>
          <label for="medium-option1">Pen</label>
          <input type="radio" id="medium-option2" class="toggle-select toggle-select-right" name="medium" value="pencil">
          <label for="medium-option2">Pencil</label>
        </div>

        <div id="hint" class="hint">
          <button>Show hint</button> 
        </div>
    </section>
    </main>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/Timer.js"></script>
    <script src="js/Sudoku.js"></script>
    <script>

      var sudokuBoard = $("#soduku-board");
      var sudoku = new SudokuGame("easy");
      var puzzle;
      var timer = new Timer("#timer-1 .time-passed");
      var medium = "pen";

      var maintainAspectRatio = function(){
        sudokuBoard.css("height", sudokuBoard.width());
      }

      $(document).on("load", (function(){
        //initializing function calls
        maintainAspectRatio();
        drawPuzzleDom(sudoku.puzzle);
      })());
      
      $(window).resize(maintainAspectRatio);

      // Widget Event handlers (TODO: consolidate events)

      $("#hint").on("click", function(event){
        var hintInfo = sudoku.giveHint();
        if(hintInfo.hint){
          inputCellDom(hintInfo.row, hintInfo.column, hintInfo.hint, "show-hint");
          sudoku.playerInput(hintInfo.row, hintInfo.column, hintInfo.hint);
        }
        console.log(hintInfo);
        console.log(sudoku.print(sudoku.playersGrid));

      })

      $("#timer-1 .toggle").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        target.checked ? timer.start() : timer.stop();

      });

      $("#pallete .toggle-select").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        medium = target.value;
      });

      sudokuBoard.on("focusin", function(event){
        var target = event.target ? event.target : event.srcElement;
        if(!target.className && !target.disabled){
          $(target).removeClass().addClass(medium);
        }
      });

      sudokuBoard.on("change", function(event){
        console.log("cell value changed...");
        var $target = event.target ? $(event.target) : $(event.srcElement);
        var newCellValue = $target.val();
        var cell = $target.attr("data-cell").split(",");
        console.log(cell);
        console.log(newCellValue);
        $target.removeClass().addClass(medium);
        // console.log(event.target.dataset.cell);
        //validate value of cell 
        try {
          sudoku.playerInput(cell[0], cell[1], newCellValue);
          // if(sudoku.isComplete()){
            //notify play of win or lose
        //   }
        }
        catch(error){
          var previousCellValue = formatCellValue(cell[0], cell[1]);
          $target.val(previousCellValue);
          console.log(error);
        //   //notify player of invalid entry
        }
      });

      function formatCellValue(row, column){
        var cellValue = sudoku.playersGrid[row][column];
        cellValue = cellValue === 0 ? " " : cellValue;
        return cellValue;
      }

      //HTML5 Number input doesn't log validation errors
      sudokuBoard.on("focusout", function(event){
        var target = event.target ? event.target : event.srcElement;
        if(!target.checkValidity()){
          var cell = target.dataset.cell.split(",");
          var previousCellValue = formatCellValue(cell[0], cell[1]);
          $(target).val(previousCellValue);
          
          throw {name: "invalidGuess", message: "a number between 1 and 9 is required"};
        }
        else{
          $target = $(target);
          $target.val() == "" ? $target.removeClass() : null;
        }

      });

      // END event handlers

      function inputCellDom(row, column, value, className){
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");

          if(cellLocation[0] == row && cellLocation[1] == column){
            $(this).val(value);
            className ? $(this).removeClass().addClass(className) : null;
          }
        });
      }

      function drawPuzzleDom(puzzle){
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");
          var disabled = true;
          var value = puzzle[cellLocation[0]][cellLocation[1]];

          if(value === 0){
            disabled = false;
            value = " ";
          }

          $(this).val(value);
          $(this).attr("disabled", disabled);
        });
      }

      sudoku.print(sudoku.puzzle);

    </script>
  </body>
</html>
