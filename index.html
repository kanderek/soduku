<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Uber - Soduku</title>
    <link rel="stylesheet" href="css/sudoku.css">
  </head>

  <body>

    <header>
      <div class="headline">
        <h1>Sudoku Times</h1>
        <nav class="game-menu">
          <ul class="group">
            <li class="select-new-puzzle">New puzzle</li>
            <li class="game-settings"></li>
          </ul>
        </nav>

        <div class="game-menu-options">
          <div id="select-puzzle-options">
              <input type="radio" id="dificulty-option1" class="toggle-select-list select-option" name="dificulty" value="easy" checked>
              <label for="dificulty-option1">Easy</label>
              <input type="radio" id="dificulty-option2" class="toggle-select-list select-option" name="dificulty" value="medium">
              <label for="dificulty-option2">Medium</label>
              <input type="radio" id="dificulty-option3" class="toggle-select-list select-option" name="dificulty" value="hard">
              <label for="dificulty-option3">Hard</label>
          </div>

          <div id="game-settings-options">
            <p>Sudoku Rules</p>
            <input type="checkbox" id="show-possible-values-option" class="">
            <label for="show-possible-values">Show Possible Values</label>
            <input type="checkbox" id="hightlight-clashes" class="show-clash-highlights-option">
            <label for="hightlight-clashes">Hard</label>
          </div>
        </div>

      </div>
    </header>

    <main class="group">

      <section id="game-details" class="group">
        <div class="difficulty-display">
          <p>Difficulty:</p>
          <p><span class="difficulty">Easy</span></p>
        </div>

        <div id="timer-1" class="timer">
          <div class="timer-display">
            <p>Timer:</p>
            <p><span class="time-passed">0:00</span></p>
          </div>
          <input type="checkbox" class="toggle" id="timer-start" value="start">
          <label for="timer-start">Start</label>
        </div>
      </section>

      <section id="puzzle" class="group">
    <table id="soduku-board">
      <tbody>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,0"><div class="hint-overlay"></div></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="0,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="1,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="2,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="3,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="4,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="5,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="6,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="7,8"><div class="hint-overlay"></div></div></td>
      </tr>
      <tr>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,0"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,1"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,2"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,3"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,4"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,5"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,6"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,7"><div class="hint-overlay"></div></div></td>
        <td><div class="cell"><input type="number" min="1" max="9" data-cell="8,8"><div class="hint-overlay"></div></div></td>
      </tr>
    </tbody>
    </table>
  </section>

      <section id="game-controls" class="group">
        <div id="pallete" class="medium-toggle group">
          <input type="radio" id="medium-option1" class="toggle-select toggle-select-left" name="medium" value="pen" checked>
          <label for="medium-option1">Pen</label>
          <input type="radio" id="medium-option2" class="toggle-select toggle-select-right" name="medium" value="pencil">
          <label for="medium-option2">Pencil</label>
        </div>

        <div id="hint" class="hint">
          <button>Show hint</button> 
        </div>
    </section>
    </main>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/Timer.js"></script>
    <script src="js/Sudoku.js"></script>
    <script>

      var sudokuBoard = $("#soduku-board");
      var sudoku = new SudokuGame("easy");
      var puzzle;
      var timer = new Timer("#timer-1");
      var medium = "pen";
      var difficulty = "easy";
      var showPossibleValues = false;
      var showClashes = true;

      var maintainAspectRatio = function(){
        sudokuBoard.css("height", sudokuBoard.width());
      }

      $(document).on("load", (function(){
        //initializing function calls
        maintainAspectRatio();
        drawPuzzleDom(sudoku.puzzle);
        disableCells();
        timer.start();
      })());
      
      $(window).resize(maintainAspectRatio);

      // Widget Event handlers (TODO: consolidate events)

      $(".game-menu li").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        switch(target.className){
          case "select-new-puzzle": 
            $("#game-settings-options").hide();
            $("#select-puzzle-options").toggle(); 
            break;
          case "game-settings": 
            $("#select-puzzle-options").hide()
            $("#game-settings-options").toggle();
            break;
        }
      });

      $("#select-puzzle-options").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        difficulty = target.value;
        sudoku = new SudokuGame(difficulty);
        drawPuzzleDom(sudoku.puzzle);
        disableCells();
        $("#game-details .difficulty").html(difficulty);
        timer.reset();
        $(this).hide();
      })

      $("#hint").on("click", function(event){
        var hintInfo = sudoku.giveHint();
        if(hintInfo.hint){
          inputCellDom(hintInfo.row, hintInfo.column, hintInfo.hint, "show-hint");
          sudoku.playerInput(hintInfo.row, hintInfo.column, hintInfo.hint);
        }
        drawPuzzleDom(sudoku.playersGrid);
        // console.log(hintInfo);
        // console.log(sudoku.print(sudoku.playersGrid));
      })

      $("#timer-1 .toggle").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        target.checked ? timer.start() : timer.stop();

      });

      $("#pallete .toggle-select").on("click", function(event){
        var target = event.target ? event.target : event.srcElement;
        medium = target.value;
      });

      sudokuBoard.on("focusin", function(event){
        var target = event.target ? event.target : event.srcElement;
        $(target).removeClass().addClass(medium);
      });

      sudokuBoard.on("change", function(event){
        console.log("cell value changed...");
        var $target = event.target ? $(event.target) : $(event.srcElement);
        var newCellValue = $target.val();
        var cell = $target.attr("data-cell").split(",");
        var row = cell[0];
        var column = cell[1];

        $target.removeClass().addClass(medium);
        // console.log(event.target.dataset.cell);
        //validate value of cell 
        try {
          if(showClashes){
            var possibleValues = sudoku.getPossibleValuesForCell(sudoku.playersGrid, row, column, newCellValue);
            highlightClash(possibleValues.clash, row, column);
          }
          sudoku.playerInput(row, column, newCellValue);
          drawPuzzleDom(sudoku.playersGrid);//causes a required to be added to the changed cell

          // if(sudoku.isComplete()){
            //notify play of win or lose
        //   }
        }
        catch(error){
          var previousCellValue = formatCellValue(cell[0], cell[1]);
          $target.val(previousCellValue);
          console.log(error);
        //   //notify player of invalid entry
        }
      });

      function formatCellValue(row, column){
        var cellValue = sudoku.playersGrid[row][column];
        cellValue = cellValue === 0 ? " " : cellValue;
        return cellValue;
      }

      //HTML5 Number input doesn't log validation errors
      sudokuBoard.on("focusout", function(event){
        var target = event.target ? event.target : event.srcElement;
        if(!target.checkValidity()){
          var cell = target.dataset.cell.split(",");
          var previousCellValue = formatCellValue(cell[0], cell[1]);
          $(target).val(previousCellValue);
          
          throw {name: "invalidGuess", message: "a number between 1 and 9 is required"};
        }
        else{
          $target = $(target);
          $target.val() == "" ? $target.removeClass() : null;
        }

      });

      // END event handlers

      function inputCellDom(row, column, value, className){
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");

          if(cellLocation[0] == row && cellLocation[1] == column){
            $(this).val(value);
            className ? $(this).removeClass().addClass(className) : null;
          }
        });
      }

      function drawPuzzleDom(puzzle){
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");
          var row = cellLocation[0];
          var column = cellLocation[1];
          var value = puzzle[row][column];
          var possibleValues = showPossibleValues ? sudoku.getPossibleValuesForCell(puzzle, row, column) : {};

          $(this).next().empty();

          if(value === 0){
            value = " ";

            for(possibleValue in possibleValues.values){
              if(possibleValues.values[possibleValue]){
                $(this).next().append(possibleValue);
              }
            }
          }

          $(this).val(value);
          
        });
      }

      function disableCells(){
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");
          var row = cellLocation[0];
          var column = cellLocation[1];
          var disabled = true;

          if(sudoku.puzzle[row][column] == 0){
            disabled = false;
          }

          $(this).removeClass();
          // $(this).parent().parent().removeClass();
          $(this).attr("disabled", disabled);
        });
      }

      function highlightClash(typeOfClash, row, column){
        console.log(typeOfClash);

        var subgrid = sudoku.whichSubGrid(row, column);
        console.log(subgrid);
        //startRowIndex - endRowIndex
        //startColumnIndex - endColumnIndex
        
        $("td input").each(function(index, cell){
          var cellLocation = $(this).attr("data-cell").split(",");
          var currentRow = cellLocation[0];
          var currentColumn = cellLocation[1];

          if(typeOfClash.row && row === currentRow){
            $(this).parent().parent().addClass("clash");
          }

          if(typeOfClash.column && column === currentColumn){
            $(this).parent().parent().addClass("clash");
          }

          if(typeOfClash.subgrid && currentRow>= subgrid.startRowIndex && currentRow <= subgrid.endRowIndex 
             && currentColumn >= subgrid.startColumnIndex && currentColumn <= subgrid.endColumnIndex){
             $(this).parent().parent().addClass("clash");
          }
          
        });
      }

    </script>
  </body>
</html>
